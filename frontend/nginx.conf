upstream backend_app {
    # Talk to the Go backend container on its internal port
    # (docker-compose maps host 8001 -> container 8000)
    server backend:8000;
}

server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    # ----- Static pages -----
    # Home page
    location = / {
        try_files /index.html =404;
    }

    # Cart & checkout pages
    location = /cart.html {
        try_files /cart.html =404;
    }

    location = /checkout.html {
        try_files /checkout.html =404;
    }

    # ----- API -> Go backend -----
    # htmx calls like "products/phones" => /products/phones
    location /products {
        proxy_pass http://backend_app;
    }

    # /cart, /cart/add, /cart/view, etc.
    location /cart {
        proxy_pass http://backend_app;
    }

    # /checkout (POST) from your checkout form
    location /checkout {
        proxy_pass http://backend_app;
    }

    # ----- Static assets (css/js/images) -----
    # Anything that isn't caught above and exists on disk is served as a file
    location / {
        try_files $uri $uri/ =404;
    }
}
